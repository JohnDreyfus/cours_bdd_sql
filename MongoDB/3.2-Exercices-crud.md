# Exercices CRUD

## Exercice 1 : Insertion de données

### 1.1 Ajouter un nouveau client

Insérer un client avec les informations suivantes :

- Prénom : Claire
- Nom : Rousseau
- Email : claire.rousseau@example.com
- Téléphone : +33667890123
- Adresse de facturation et de livraison à Bordeaux
- Abonné à la newsletter
- Langue : fr, devise : EUR

### 1.2 Ajouter plusieurs produits

Insérer 3 nouveaux produits de la catégorie Informatique :

- Une souris sans fil
- Un écran 27 pouces
- Une webcam HD

Chaque produit doit avoir : nom, description, prix, stock, SKU, catégorie (référence), spécifications, tags.

### 1.3 Ajouter une nouvelle catégorie

Créer une catégorie "Accessoires" avec comme parent la catégorie "Électronique".

---

## Exercice 2 : Lecture de données

### 2.1 Requêtes simples

1. Afficher tous les produits de la catégorie Informatique
2. Afficher le client avec l'email "pierre.martin@example.com"
3. Afficher toutes les commandes avec le statut "delivered"
4. Afficher les produits dont le prix est supérieur à 500 EUR

### 2.2 Projections

1. Afficher uniquement le nom et le prix de tous les produits
2. Afficher les clients avec uniquement firstName, lastName et email (sans _id)
3. Afficher les commandes avec orderNumber, status et total (pricing.total)

### 2.3 Requêtes avec tri et limite

1. Afficher les 3 produits les plus chers
2. Afficher les 5 dernières commandes (par orderDate)
3. Afficher les clients triés par ordre alphabétique (lastName)

---

## Exercice 3 : Mise à jour de données

### 3.1 Utilisation de $set

1. Modifier le prix du produit "Clavier mécanique RGB" à 119.99 EUR
2. Changer le statut de la commande "ORD-2024-007" à "shipped"
3. Mettre à jour le stock du "Smartphone Galaxy S24" à 150 unités

### 3.2 Utilisation de $inc

1. Augmenter le stock de tous les T-shirts de 50 unités
2. Incrémenter le nombre total de commandes (totalOrders) de Pierre Martin de 1
3. Décrémenter le stock du produit avec le SKU "LAPTOP-XPS15-001" de 2 unités

### 3.3 Utilisation de $push

1. Ajouter un nouvel avis (review) au produit "Clavier mécanique RGB" :
    - customer_id : ObjectId("650a3333333333333333002")
    - rating : 4
    - comment : "Bon clavier, frappes agréables"
    - date : date actuelle
    - verified_purchase : true

2. Ajouter un tag "promo" au produit "T-shirt coton bio"

3. Ajouter une nouvelle adresse de livraison pour Marie Dubois :
    - Type : shipping
    - isDefault : false
    - Adresse à Nice

### 3.4 Utilisation de $pull

1. Retirer le tag "gaming" du produit "Clavier mécanique RGB"
2. Supprimer l'adresse de livraison de Marseille pour Marie Dubois

### 3.5 Mise à jour multiple

1. Désactiver tous les produits dont le stock est égal à 0 (isActive: false)
2. Appliquer une remise de 10% sur tous les produits de la catégorie Vêtements
3. Passer toutes les commandes "pending" de plus de 7 jours en statut "cancelled"

### 3.6 Upsert

1. Mettre à jour ou créer un produit avec le SKU "MOUSE-WIRELESS-001"
2. Mettre à jour les préférences d'un client ou créer le client si l'email n'existe pas

---

## Exercice 4 : Suppression de données

### 4.1 Suppressions simples

1. Supprimer le produit avec le SKU "KEYB-MECH-RGB-001"
2. Supprimer le client avec l'email "ancien@example.com" (s'il existe)
3. Supprimer la commande "ORD-2024-001"

### 4.2 Suppressions multiples

1. Supprimer tous les avis (reviews) avec un rating inférieur à 3 dans tous les produits
2. Supprimer toutes les commandes avec le statut "cancelled"
3. Supprimer tous les produits inactifs (isActive: false)

### 4.3 Soft delete

Implémenter un système de suppression logique :

1. Ajouter un champ "deleted" et "deletedAt" au lieu de supprimer physiquement un produit
2. Créer une requête pour "archiver" un client au lieu de le supprimer

---

## Exercice 5 : Opérations combinées

### 5.1 Scénario : Traitement d'une commande

Simuler le cycle de vie d'une commande :

1. Créer une nouvelle commande pour le client Thomas Robert
2. Décrémenter le stock des produits commandés
3. Mettre à jour les statistiques du client (totalOrders, totalSpent)
4. Ajouter les étapes dans la timeline de la commande
5. Changer le statut de la commande en "processing" puis "shipped"

### 5.2 Scénario : Retour produit

Un client retourne un produit :

1. Changer le statut de la commande en "returned"
2. Réincrémenter le stock du produit
3. Mettre à jour les statistiques du client

### 5.3 Scénario : Gestion des avis

1. Ajouter un avis sur un produit
2. Recalculer la moyenne (rating.average) et le nombre d'avis (rating.count)
3. Mettre à jour la date de modification du produit (updatedAt)

---

## Exercice 6 : Requêtes avancées de lecture

### 6.1 Recherche dans les sous-documents

1. Trouver tous les clients ayant une adresse à Paris
2. Trouver tous les produits avec des spécifications contenant "Samsung"
3. Trouver toutes les commandes avec un article spécifique (product_id)

### 6.2 Recherche dans les tableaux

1. Trouver tous les produits avec le tag "bio"
2. Trouver tous les clients abonnés à la newsletter
3. Trouver tous les produits ayant au moins un avis avec rating = 5

### 6.3 Agrégations simples

1. Compter le nombre total de produits par catégorie
2. Calculer le montant total des commandes par client
3. Compter le nombre de commandes par statut