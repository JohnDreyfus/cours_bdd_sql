# 4. Requêtes avancées

## 4.1 Opérateurs de comparaison

Les opérateurs de comparaison permettent de filtrer les documents selon des critères précis.

### Opérateurs disponibles
- **$eq** : égal à (implicite dans la plupart des cas)
- **$ne** : différent de
- **$gt** : supérieur à (greater than)
- **$gte** : supérieur ou égal à
- **$lt** : inférieur à (less than)
- **$lte** : inférieur ou égal à
- **$in** : valeur présente dans un tableau
- **$nin** : valeur absente d'un tableau

### Exemples
```javascript
// Produits avec un prix supérieur à 100
db.produits.find({ prix: { $gt: 100 } })

// Produits avec un prix entre 50 et 150
db.produits.find({
    prix: { $gte: 50, $lte: 150 }
})

// Produits dont la catégorie est électronique, informatique ou gaming
db.produits.find({
    categorie: { $in: ["électronique", "informatique", "gaming"] }
})

// Produits qui ne sont pas en rupture de stock
db.produits.find({
    stock: { $ne: 0 }
})
```

---

## 4.2 Opérateurs logiques

Les opérateurs logiques combinent plusieurs conditions.

### Opérateurs disponibles
- **$and** : toutes les conditions doivent être vraies
- **$or** : au moins une condition doit être vraie
- **$not** : inverse une condition
- **$nor** : aucune condition ne doit être vraie

### Exemples
```javascript
// Produits en promotion ET en stock
db.produits.find({
    $and: [
        { promotion: true },
        { stock: { $gt: 0 } }
    ]
})

// Syntaxe simplifiée pour $and (équivalent)
db.produits.find({
    promotion: true,
    stock: { $gt: 0 }
})

// Produits de catégorie "livre" OU prix inférieur à 20
db.produits.find({
    $or: [
        { categorie: "livre" },
        { prix: { $lt: 20 } }
    ]
})

// Produits ni en rupture ni en précommande
db.produits.find({
    $nor: [
        { stock: 0 },
        { statut: "précommande" }
    ]
})

// Combinaison complexe
db.produits.find({
    $and: [
        { prix: { $gte: 10, $lte: 100 } },
        { $or: [
                { categorie: "électronique" },
                { marque: "Samsung" }
            ]
        }
    ]
})
```

---

## 4.3 Recherche dans les tableaux

MongoDB offre des opérateurs spécifiques pour interroger les champs de type tableau.

### Opérateurs pour tableaux
- **Recherche simple** : vérifie si une valeur est présente
- **$elemMatch** : au moins un élément du tableau satisfait plusieurs conditions
- **$all** : le tableau contient toutes les valeurs spécifiées
- **$size** : le tableau a une taille spécifique

### Exemples
Structure de document :
```javascript
{
    titre: "Développement web moderne",
        tags: ["javascript", "react", "nodejs"],
        auteurs: [
        { nom: "Dupont", specialite: "frontend" },
        { nom: "Martin", specialite: "backend" }
    ]
}
```

Requêtes :
```javascript
// Articles contenant le tag "javascript"
db.articles.find({
    tags: "javascript"
})

// Articles contenant tous les tags spécifiés
db.articles.find({
    tags: { $all: ["javascript", "react"] }
})

// Articles ayant exactement 3 tags
db.articles.find({
    tags: { $size: 3 }
})

// Articles avec un auteur spécialisé en backend
db.articles.find({
    "auteurs.specialite": "backend"
})

// Articles avec un auteur nommé "Dupont" ET spécialisé en frontend
db.articles.find({
    auteurs: {
        $elemMatch: {
            nom: "Dupont",
            specialite: "frontend"
        }
    }
})
```

---

## 4.4 Recherche dans les sous-documents

La notation par points permet d'accéder aux champs imbriqués.

### Notation par points
- Utilisation du point pour naviguer dans la hiérarchie
- Fonctionne sur plusieurs niveaux de profondeur
- Attention aux guillemets obligatoires

### Exemples
Structure de document :
```javascript
{
    nom: "Dupont",
        adresse: {
        rue: "5 rue de la Paix",
            ville: "Paris",
            codePostal: "75001",
            coordonnees: {
            latitude: 48.856614,
                longitude: 2.352222
        }
    },
    commandes: [
        {
            id: 1,
            total: 150,
            articles: [
                { nom: "Livre", prix: 15 },
                { nom: "Stylo", prix: 5 }
            ]
        }
    ]
}
```

Requêtes :
```javascript
// Clients habitant à Paris
db.clients.find({
    "adresse.ville": "Paris"
})

// Clients avec un code postal commençant par 75
db.clients.find({
    "adresse.codePostal": /^75/
})

// Clients avec des coordonnées spécifiques
db.clients.find({
    "adresse.coordonnees.latitude": { $gt: 48 },
    "adresse.coordonnees.longitude": { $lt: 3 }
})

// Clients ayant une commande supérieure à 100
db.clients.find({
    "commandes.total": { $gt: 100 }
})

// Clients ayant acheté un article spécifique
db.clients.find({
    "commandes.articles.nom": "Livre"
})

// Combinaison avec $elemMatch pour des critères multiples
db.clients.find({
    commandes: {
        $elemMatch: {
            total: { $gt: 100 },
            "articles.nom": "Livre"
        }
    }
})
```